# YADAMU QA Orchestrator
# Individual test services using existing extendedTests.sh logic

x-orchestrator-common: &orchestrator-common
  build:
    context: .
    dockerfile: Dockerfile.orchestrator
    additional_contexts:
      src:    c:/development/YADAMU/src
      bin:    c:/development/YADAMU/bin
      qa:     c:/development/YADAMU/qa
      docker: c:/development/YADAMU/docker
      util:   c:/development/YADAMU/utilities
  volumes:
    - /var/run/docker.sock:/var/run/docker.sock
  networks:
    - yadamu-net
  environment:
    - CONTAINER_NAME=YADAMU-01
    - MEMORY=16g
    - NETWORK=YADAMU-NET
    - VOLUME=YADAMU_01-SHARED
    - IMAGE=yadamu/secure:latest
    - MSSQL12=${MSSQL12:-192.168.1.234}
    - MSSQL14=${MSSQL14:-192.168.1.235}
  stdin_open: true
  tty: true
  restart: "no"

services:
  # ============================================
  # Top-level test suites (unchanged)
  # ============================================
  standard:
    <<: *orchestrator-common
    container_name: yadamu-standard-orchestrator
    command: sh -c "/usr/local/bin/runStandardTests.sh && tail -f /dev/null"

  extended:
    <<: *orchestrator-common
    container_name: yadamu-extended-orchestrator
    command: sh -c "/usr/local/bin/runExtendedTests.sh && tail -f /dev/null"

  comprehensive:
    <<: *orchestrator-common
    container_name: yadamu-comprehensive-orchestrator
    command: sh -c "/usr/local/bin/runComprehensiveTests.sh && tail -f /dev/null"

  recreate-db:
    <<: *orchestrator-common
    container_name: yadamu-recreate-db
    command: sh -c "/usr/local/bin/recreateDB.sh && tail -f /dev/null"

  # ============================================
  # Individual test services
  # These use the run_test function from extendedTests.sh
  # ============================================
  
  cmdline:
    <<: *orchestrator-common
    container_name: yadamu-test-cmdline
    command: sh -c "/usr/local/bin/runIndividualTest.sh cmdline && tail -f /dev/null"

  oracle11g:
    <<: *orchestrator-common
    container_name: yadamu-test-oracle11g
    command: sh -c "/usr/local/bin/runIndividualTest.sh oracle11g && tail -f /dev/null"

  oracle19c:
    <<: *orchestrator-common
    container_name: yadamu-test-oracle19c
    command: sh -c "/usr/local/bin/runIndividualTest.sh oracle19c && tail -f /dev/null"

  oracle21c:
    <<: *orchestrator-common
    container_name: yadamu-test-oracle21c
    command: sh -c "/usr/local/bin/runIndividualTest.sh oracle21c && tail -f /dev/null"

  oracle23ai:
    <<: *orchestrator-common
    container_name: yadamu-test-oracle23ai
    command: sh -c "/usr/local/bin/runIndividualTest.sh oracle23ai && tail -f /dev/null"

  oracle26ai:
    <<: *orchestrator-common
    container_name: yadamu-test-oracle26ai
    command: sh -c "/usr/local/bin/runIndividualTest.sh oracle26ai && tail -f /dev/null"

  vertica09:
    <<: *orchestrator-common
    container_name: yadamu-test-vertica09
    command: sh -c "/usr/local/bin/runIndividualTest.sh vertica09 && tail -f /dev/null"

  db2:
    <<: *orchestrator-common
    container_name: yadamu-test-db2
    command: sh -c "/usr/local/bin/runIndividualTest.sh db2 && tail -f /dev/null"

  cockroach:
    <<: *orchestrator-common
    container_name: yadamu-test-cockroach
    command: sh -c "/usr/local/bin/runIndividualTest.sh cockroach && tail -f /dev/null"

  yugabyte:
    <<: *orchestrator-common
    container_name: yadamu-test-yugabyte
    command: sh -c "/usr/local/bin/runIndividualTest.sh yugabyte && tail -f /dev/null"

  snowflake:
    <<: *orchestrator-common
    container_name: yadamu-test-snowflake
    command: sh -c "/usr/local/bin/runIndividualTest.sh snowflake && tail -f /dev/null"

networks:
  yadamu-net:


volumes:
  yadamu-shared:
    name: YADAMU_01-SHARED

